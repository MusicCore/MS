<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="navbar">
    <link id="theme" th:href="@{/static/bootstrap/css/bootstrap.min.css}" rel="stylesheet"/>
    <link  th:href="@{/static/bootstrap/css/bootstrap-theme.min.css}" rel="stylesheet"/>
    <link  th:href="@{/static/css/sweetalert.min.css}" rel="stylesheet"/>
    <script th:src="@{/static/js/jquery-2.1.1.min.js}" type="text/javascript"></script>
    <script th:src="@{/static/js/jquery.cookie.min.js}" type="text/javascript"></script>
    <script th:src="@{/static/bootstrap/js/bootstrap.min.js}" type="text/javascript"></script>
    <script th:src="@{/static/js/sweetalert.min.js}" type="text/javascript"></script>

    <!--<div class="container">-->
    <style>
        .navbar_black{
            background-color: rgba(0, 0, 0, 0.7);
        }
        .a_url{
            color: white;
        }
        .a_url:hover{
            color: crimson;
        }
    </style>
    <div class="row clearfix">
        <div class="col-md-12 column">
            <nav class="navbar navbar_black" role="navigation">
                <div class="navbar-header">
                    <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
                    </button> <a class="navbar-brand a_url" href="/">普通人口琴</a>
                </div>

                <div id="bs-example-navbar-collapse-1" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <a class="navbar-brand a_url" type="button" href="/bkimgmanage">背景管理</a>
                        <a class="navbar-brand a_url" type="button" href="/imgmanage">图片管理</a>
                        <li id="user_avatar">

                        </li>
                        <li class="dropdown" id="user_info">
                            <a href="#" class="dropdown-toggle a_url" role="button" data-toggle="dropdown" id="dropdownMenu1">
                                <span id="user_name"></span>
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1" role="menu">
                                <li role="presentation" tabindex="-1"><a href="javascript:void(0);"><span class="glyphicon glyphicon-user"></span> 个人信息</a></li>
                                <li role="presentation" tabindex="-1"><a href="javascript:void(0);"><span class="glyphicon glyphicon-bookmark"></span> 收藏夹 </a></li>
                                <li role="presentation" tabindex="-1"><a onclick="logout()" href="javascript:void(0);"><span class="glyphicon glyphicon-off"></span> 注销退出 </a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>

                <div class="row clearfix">
                    <div class="col-md-12 column visible-md visible-lg">
                        <nav class="navbar-default navbar-fixed-bottom" role="navigation" style="text-align: center">
                            <div style="display: none" id="img_loading"><img th:src="@{/static/img/body-img/other/loading.gif}"></div>
                        </nav>
                    </div>
                </div>
        </div>
</div>
    <script>
        $(document).ajaxSuccess(function(event,xhr,options){
            var data=xhr.responseJSON;
            if(data!=undefined){
                // console.log(data)
                    if(data.code == 50014){
                        // console.log(data)
                        swal({
                            title: data.message,
                            text: "用户信息过期，请您重新登录",
                            icon:  "warning",
                            timer: 5000,
                            allowOutsideClick : true
                        });
                        $.cookie('token', null)
                        $.cookie('name', null)
                        $.cookie('avatar', null)
                        setTimeout(function () {
                            window.location.href = '/'
                        }, 3000)
                    }
            }
        });
        $(document).ready(function () {
            // console.log($.cookie('name'))
            // console.log($.cookie('avatar'))
            if(typeof ($.cookie('name')) == 'undefined' || $.cookie('name') == 'null' || $.cookie('name') == ''){

            }else {
                $('#user_name').html($.cookie('name'))
            }
            if(typeof ($.cookie('avatar')) == 'undefined' || $.cookie('avatar') == 'null' || $.cookie('avatar') == ''){
                $('#user_info').hide()
              }else{
                $('#user_avatar').append("<img class='img-circle' width='49px' height='49px' src="+$.cookie('avatar')+" alt=\"图片加载失败了\">")
            }
             })
        function logout() {
            $.ajax({
                type: "post",
                dataType: "json",
                url: "/api/logout" ,
                success: function (result) {
                    if(result.code == 200) {
                        swal({
                            title: result.message,
                            text: "正在前往首页！",
                            icon:  "success",
                            timer: 3000,
                            allowOutsideClick : true
                        });
                        $.cookie('token', null)
                        $.cookie('name', null)
                        $.cookie('avatar', null)
                        setTimeout(function () {
                            window.location.href = '/'
                        }, 3000)
                    }
                },
                error : function() {
                    swal({
                        title: "对不起，发生了请求错误",
                        text: "正在竭力抢修！",
                        icon:  "error",
                        timer: 2000,
                        allowOutsideClick : true
                    });
                }
            });
        }
    </script>
</div>
</body>
</html>
